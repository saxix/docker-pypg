---
language: bash
services: docker

dist: trusty

env:
  - VERSION=jessie VARIANT=9.6
  - VERSION=jessie.slim VARIANT=9.6


before_script:
  - cd ${VERSION}-${VARIANT}
  - image="saxix/python:$VERSION${VARIANT:+-${VARIANT}}"
  - env | sort

script:
  - mkdir ./data~
  - docker build --pull -t "$image" .
  - docker run \
      -e POSTGRES_DB=test \
      -v `pwd`/data~:/var/lib/postgresql/${VARIANT}/main \
      -v `pwd`/tests:/tests \
      -it $image /bin/bash -c "cd /tests && /tests/runtests.sh"
